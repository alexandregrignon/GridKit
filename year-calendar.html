<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>Calendrier</title>
<meta property="og:title" content="Calendrier">
<meta property="og:url" content="https://alexandregrignon.github.io/calendrier/">
<meta property="og:description" content="Un calendrier imprimable avec toute l'année sur une seule page">
<link rel="stylesheet" href="style.css">
<style>
@import url('https://fonts.bunny.net/css?family=inter:300|oswald:300,400');
@media print {
  @page {
    margin: 0;
    padding: 1em;
  }
  #info {
    display: none;
  }
  td {
    font-size: 8px !important;
  }
  .weekend {
    background: #d8d8d8 !important;
  }
}
html {
  font-family: 'Oswald';
}
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
}
table {
  width: 100%;
  height: calc(100% - 2.5em);
  border-collapse: separate;
  border-spacing: .5em 0;
}
td, th {
  text-transform: uppercase;
  border-bottom: 1px solid #888;
  padding: .3vmin .3vmin;
  font-size: .9vmin;
  font-weight: 300;
  color: #000;
}
th {
  font-size: 1.1vmin;
  padding: 0;
}
td:empty {
  border: 0;
}
.date {
  display: inline-block;
  width: 1.1em;
}
.day {
  display: inline-block;
  text-align: center;
  width: 1em;
  color: #888;
}
.weekend {
  background: #eee;
  font-weight: 400;
}
p {
  margin: 0 0 .5em 0;
  text-align: center;
}
* {
  color-adjust: exact;
  -webkit-print-color-adjust: exact;
}

/* Media query pour les petits écrans */
@media (max-width: 350px) {
    #info {
        padding: 1em;
    }
    
    .option-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5em;
    }
}

/* Ajout pour que la div calendarContainer fasse 100% de la hauteur de l'écran */
#calendarContainer {
  height: 100vh;
}
</style>
</head>
<body>
<div id="info">
    <nav>
        <a href="index.html">&larr; retour à la liste des templates</a>
    </nav>
    <h1>Calendrier</h1>
    <p>Cette page est <a href="#" onclick="window.print(); return false;">imprimable</a> afin d'obtenir un calendrier affichant toutes les dates de l'année sur une seule page. Le format s'adapte automatiquement pour tenir sur un seul format de papier, quelle que soit sa taille. Pour de meilleurs résultats, réglez l'orientation en paysage et désactivez l'en-tête et le pied de page.</p>

    <h2>Options</h2>
    <!-- Ajout du sélecteur de langue avant le sélecteur d'année -->
    <div class="option-group">
        <div class="option-header">
            <label for="locale-select">Langue</label>
        </div>
        <select id="locale-select">
            <option value="fr-FR">Français</option>
            <option value="en-US">English (US)</option>
            <option value="en-GB">English (UK)</option>
            <option value="de-DE">Deutsch</option>
            <option value="es-ES">Español</option>
            <option value="it-IT">Italiano</option>
            <option value="pt-PT">Português</option>
            <option value="nl-NL">Nederlands</option>
            <option value="pl-PL">Polski</option>
            <option value="ja-JP">日本語</option>
            <option value="zh-CN">中文</option>
        </select>
    </div>
    <div class="option-group">
        <div class="option-header">
            <label for="year-select">Année</label>
            <div class="value" id="selectedYear"></div>
        </div>
        <select id="year-select">
            <!-- Les années seront ajoutées via JavaScript -->
        </select>
    </div>
    
    <div class="button-group">
        <button id="btn-normal" class="active">Vue standard</button>
        <button id="btn-aligned">Semaines alignées</button>
    </div>

    <p style="font-size: 80%; color: #999;">Projet <a href="https://github.com/alexandregrignon/GridKit">GridKit</a> par <a href="https://alexandregrignon.fr">Alexandre Grignon</a> &#183; Le Calendrier est adapté en Javascript à partir du projet <a href="https://neatnik.net/dispenser/?project=calendar">Calendar</a> réalisé par <a href="https://neatnik.net/">Neatnik</a></p>
</div>
<div id="calendarContainer"></div>
<script>
document.addEventListener("DOMContentLoaded", function() {
    // Configuration initiale
    const params = new URLSearchParams(window.location.search);
    const currentYear = new Date().getFullYear();
    const state = {
        year: params.get('year') ? parseInt(params.get('year')) : currentYear,
        layout: params.get('layout'),
        locale: params.get('locale') || 'fr-FR'
    };

    // Initialisation des éléments UI
    const elements = {
        localeSelect: document.getElementById("locale-select"),
        yearSelect: document.getElementById("year-select"),
        btnNormal: document.getElementById("btn-normal"),
        btnAligned: document.getElementById("btn-aligned"),
        container: document.getElementById("calendarContainer")
    };

    // Fonction utilitaire pour la navigation
    function navigate(updates = {}) {
        const nextUrl = new URL(window.location.href);
        const newState = { ...state, ...updates };
        
        Object.entries(newState).forEach(([key, value]) => {
            if (value && (key !== 'year' || value !== currentYear)) {
                nextUrl.searchParams.set(key, value);
            } else {
                nextUrl.searchParams.delete(key);
            }
        });
        
        window.location.href = nextUrl.toString();
    }

    // Fonction pour créer un élément avec des attributs
    function createElement(tag, attrs = {}, children = []) {
        const element = document.createElement(tag);
        Object.entries(attrs).forEach(([key, value]) => {
            if (value) element[key] = value;
        });
        children.forEach(child => element.appendChild(child));
        return element;
    }

    // Fonction pour formater une date selon la locale
    function formatDate(date, options) {
        try {
            return date.toLocaleString(state.locale, options);
        } catch (e) {
            return date.toLocaleString('fr-FR', options);
        }
    }

    // Génération des années dans le select
    function initializeYearSelect() {
        const range = [...Array(21)].map((_, i) => currentYear - 10 + i);
        elements.yearSelect.append(...range.map(y => 
            createElement('option', {
                value: y,
                textContent: y,
                selected: y === state.year
            })
        ));
    }

    // Création des en-têtes de mois
    function createMonthHeaders() {
        return createElement('tr', {}, 
            Array.from({length: 12}, (_, m) => {
                const date = new Date(state.year, m, 1);
                return createElement('th', {
                    textContent: formatDate(date, { month: 'short' })
                });
            })
        );
    }

    // Simplification de la fonction createDateCell
    function createDateCell(date, isAligned = false) {
        const isoWeekday = date.getDay() || 7;
        const td = createElement('td', {
            className: isoWeekday > 5 ? 'weekend' : ''
        });

        const spanDate = createElement('span', {
            className: 'date',
            textContent: date.getDate()
        });

        const spanDay = createElement('span', {
            className: 'day',
            textContent: formatDate(date, { weekday: 'short' }).charAt(0)
        });

        // Toujours afficher le même format
        td.append(spanDate, ' ', spanDay);

        return td;
    }

    // Création du calendrier
    function createCalendarTable() {
        elements.container.innerHTML = '';
        const yearDisplay = createElement('p', { textContent: state.year });
        const table = createElement('table');
        const thead = createElement('thead', {}, [createMonthHeaders()]);
        const tbody = createElement('tbody');

        // Calcul des dates pour chaque mois
        const dates = {};
        for (let m = 1; m <= 12; m++) {
            dates[m] = [];
            const firstDay = new Date(state.year, m - 1, 1);
            let firstWeekday = firstDay.getDay() || 7; // Conversion 0 (dimanche) en 7
            let dayCounter = 1;
            const daysInMonth = new Date(state.year, m, 0).getDate();

            // Remplissage du tableau des dates
            for (let x = 1; x <= 42; x++) {
                if (x < firstWeekday) {
                    dates[m][x] = 0;
                } else if (dayCounter <= daysInMonth) {
                    dates[m][x] = dayCounter++;
                } else {
                    dates[m][x] = 0;
                }
            }
        }

        // Création des lignes selon le mode d'affichage
        if (state.layout === 'aligned-weekdays') {
            // Vue alignée par jours de la semaine
            for (let day = 1; day <= 42; day++) {
                const tr = createElement('tr');
                for (let m = 1; m <= 12; m++) {
                    const d = dates[m][day];
                    if (d === 0) {
                        tr.appendChild(createElement('td'));
                    } else {
                        const date = new Date(state.year, m - 1, d);
                        tr.appendChild(createDateCell(date, true));
                    }
                }
                if (tr.textContent.trim()) { // N'ajoute que les lignes non vides
                    tbody.appendChild(tr);
                }
            }
        } else {
            // Vue standard (1-31)
            for (let day = 1; day <= 31; day++) {
                const tr = createElement('tr');
                for (let m = 1; m <= 12; m++) {
                    const daysInMonth = new Date(state.year, m, 0).getDate();
                    if (day > daysInMonth) {
                        tr.appendChild(createElement('td'));
                    } else {
                        const date = new Date(state.year, m - 1, day);
                        tr.appendChild(createDateCell(date, false));
                    }
                }
                tbody.appendChild(tr);
            }
        }

        table.append(thead, tbody);
        elements.container.append(yearDisplay, table);
    }

    // Initialisation des gestionnaires d'événements
    function initializeEventListeners() {
        elements.localeSelect.value = state.locale;
        elements.localeSelect.addEventListener('change', e => 
            navigate({ locale: e.target.value }));

        elements.yearSelect.addEventListener('change', e => 
            navigate({ year: parseInt(e.target.value) }));

        if (state.layout === 'aligned-weekdays') {
            elements.btnNormal.classList.remove('active');
            elements.btnAligned.classList.add('active');
        }

        elements.btnNormal.addEventListener('click', () => 
            navigate({ layout: null }));
        
        elements.btnAligned.addEventListener('click', () => 
            navigate({ layout: 'aligned-weekdays' }));
    }

    // Initialisation
    initializeYearSelect();
    initializeEventListeners();
    createCalendarTable();
});
</script>
</body>
</html>